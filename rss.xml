<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Kira Star</title>
        <link>https://utenau.github.io/</link>
        <description>MemE is a powerful and highly customizable GoHugo theme for personal blogs.</description>
        <generator>Hugo 0.62.2 https://gohugo.io/</generator>
        
            <language>en</language>
        
        
            <managingEditor>z.giny@foxmail.com (Nadia)</managingEditor>
        
        
            <webMaster>z.giny@foxmail.com (Nadia)</webMaster>
        
        
            <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright>
        
        <lastBuildDate>Sat, 14 Mar 2020 10:36:26 +0800</lastBuildDate>
        
            <atom:link rel="self" type="application/rss+xml" href="https://utenau.github.io/rss.xml" />
        
        
            <item>
                <title>Js中的this问题</title>
                <link>https://utenau.github.io/posts/js%E4%B8%AD%E7%9A%84this%E9%97%AE%E9%A2%98/</link>
                <guid isPermaLink="true">https://utenau.github.io/posts/js%E4%B8%AD%E7%9A%84this%E9%97%AE%E9%A2%98/</guid>
                <pubDate>Fri, 13 Mar 2020 23:34:25 +0800</pubDate>
                
                    <author>z.giny@foxmail.com (Nadia)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright>
                
                    <description><![CDATA[<blockquote>
<p>首先陈述一下遇到本次问题的背景，我是在进行小程序开发学习中，遇到讲师使用了一次箭头函数，并对其使用理由进行了阐释。由于我并没有js的基础，因此我通过这个问题查阅了相关资料，并通过此次机会对相关内容进行总结。</p>
</blockquote>
<h1 id="问题">问题</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 代码A
</span><span class="c1"></span>
<span class="nx">Page</span><span class="p">(</span><span class="p">{</span>

  <span class="cm">/**
</span><span class="cm">   * 页面的初始数据
</span><span class="cm">   */</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">message</span> <span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
      <span class="nx">list</span> <span class="o">:</span> <span class="p">[</span><span class="p">]</span>
  <span class="p">}</span><span class="p">,</span>
  
  <span class="cm">/**
</span><span class="cm">   * 生命周期函数--监听页面加载
</span><span class="cm">   */</span>
    <span class="nx">onLoad</span><span class="p">(</span><span class="p">)</span><span class="p">{</span>
        <span class="nx">console</span><span class="mf">.1</span><span class="nx">og</span><span class="p">(</span><span class="s2">&#34;onLoad&#39;)
</span><span class="s2">        wx.request({
</span><span class="s2">            url:&#34;</span><span class="nx">http</span><span class="o">:</span><span class="c1">//123.207.32.32:8000/recommend&#39;，
</span><span class="c1"></span>            <span class="c1">//箭头函数中的this一层层向上找
</span><span class="c1"></span>            <span class="nx">success</span><span class="o">:</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="p">=&gt;</span><span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
            <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">list</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="p">{</span>
            <span class="nx">list</span><span class="o">:</span><span class="nx">data</span>
        <span class="p">}</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="p">)</span>
<span class="p">}</span><span class="p">,</span>
</code></pre></td></tr></table>
</div>
</div><p>这段代码是page页面的回调函数，其功能是在页面加载后发送网络请求（URL request），然后将得到的结果（是一段JSON），赋值给在App的data中定义好的list。this的作用是指明page对象，调用setData方法将data赋值给list。</p>
<p>当我们改用普通的方法写法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 代码B
</span><span class="c1"></span>    <span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://123.207.32.32:8000/recommend&#39;</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">list</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="p">{</span>
            <span class="nx">list</span><span class="o">:</span> <span class="nx">data</span>
        <span class="p">}</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>此时编译就会报错，打印this后的结果是<strong>undefined</strong> .</p>
<p>在此基础上进一步改写,又得到了正确的结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// 代码C
</span><span class="c1"></span>  <span class="nx">onLoad</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;onLoad&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://123.207.32.32:8000/recommend&#39;</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">list</span><span class="p">;</span>
        <span class="nx">_this</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="p">{</span>
          <span class="nx">list</span><span class="o">:</span> <span class="nx">data</span>
        <span class="p">}</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="p">)</span>
  <span class="p">}</span><span class="p">,</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="解释">解释</h1>
<p>上述问题的出现跟javascript中<em>this</em>这个关键字的指向有关。this是一个特殊的变量，它始终指向当前的对象。</p>
<p>this必须在对象方法下使用，才能正确地指向当前对象。如果以对象的方法形式调用此方法，可以得到正确的this指向；但如果在对象外单独调用此方法，this就会指向全局对象window。同时，如果在对象方法内的函数中使用this，也得不到正确的对象，this仍会指向window。</p>
<p>于是在js的strict模式下，this会在上述指向<em>window</em>的情况下直接指向<em>undefined</em>，以及时暴露错误。
所以就出现了<em>代码B</em>所出现的错误。</p>
<p>而当我们在<em>wx.request</em>调用的对象之外，在<em>onLoad</em>回调函数之类将this暂存给了变量_this,实际上就是将在onLoad当前的this指向的对象（也就是page对象）赋值给了_this，避免了错误的发生。</p>
<p>ES6标准新增了一种新的函数：Arrow Function（箭头函数）。
箭头函数内部的this是<em>词法作用域</em>，由<strong>上下文</strong>确定。
箭头函数完全修复了this的指向，this总是指向<em>词法作用域</em>，也就是外层调用者<strong>obj</strong>。</p>
<p>这就有了<em>代码A</em>的解决方式。</p>
]]></description>
                
                
                
                
                
                    
                        
                            
                                
                                
                                
                                    <category domain="https://utenau.github.io/categories/coding/">coding</category>
                                
                            
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://utenau.github.io/tags/javascript/">javascript</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>Hello World</title>
                <link>https://utenau.github.io/posts/hello-world/</link>
                <guid isPermaLink="true">https://utenau.github.io/posts/hello-world/</guid>
                <pubDate>Thu, 12 Mar 2020 21:06:03 +0800</pubDate>
                
                    <author>z.giny@foxmail.com (Nadia)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright>
                
                    <description><![CDATA[<p>This is a YouTube page.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/w7Ft2ymGmfc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

]]></description>
                
                
                
                
                
                    
                        
                    
                        
                            
                                
                                
                                
                                    <category domain="https://utenau.github.io/tags/test/">test</category>
                                
                            
                        
                    
                
            </item>
        
            <item>
                <title>My First Post</title>
                <link>https://utenau.github.io/posts/my-first-post/</link>
                <guid isPermaLink="true">https://utenau.github.io/posts/my-first-post/</guid>
                <pubDate>Thu, 30 Jan 2020 10:42:20 +0800</pubDate>
                
                    <author>z.giny@foxmail.com (Nadia)</author>
                
                <copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright>
                
                    <description><![CDATA[<p>Hello~</p>
]]></description>
                
                
                
                
                
                    
                        
                    
                        
                    
                
            </item>
        
    </channel>
</rss>
